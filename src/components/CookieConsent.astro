---
// Composant Cookie Consent pour la gestion RGPD des cookies
---

<!-- Import CSS et JS de vanilla-cookieconsent via CDN -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanilla-cookieconsent@3/dist/cookieconsent.css">
<script is:inline src="https://cdn.jsdelivr.net/npm/vanilla-cookieconsent@3/dist/cookieconsent.umd.js"></script>
<script is:inline>
  // Attendre que le DOM et la bibliothèque soient chargés
  window.addEventListener('load', function() {
    // Vérifier que CookieConsent est disponible
    if (typeof CookieConsent === 'undefined') {
      console.error('CookieConsent library not loaded');
      return;
    }

    // Initialisation de CookieConsent
    CookieConsent.run({
      // Définition des catégories de cookies
      categories: {
        necessary: {
          enabled: true,
          readOnly: true
        },
        analytics: {
          enabled: false,
          readOnly: false,
          autoClear: {
            cookies: [
              {
                name: /^(_ga|_gid|_gat)/
              }
            ]
          }
        },
        targeting: {
          enabled: false,
          readOnly: false,
          autoClear: {
            cookies: [
              {
                name: /^(YSC|VISITOR_INFO1_LIVE)/
              }
            ]
          }
        }
      },

      // Configuration de la langue
      language: {
        default: 'fr',
        translations: {
          fr: {
            consentModal: {
              title: 'Nous utilisons des cookies',
              description: 'Ce site utilise des cookies pour améliorer votre expérience de navigation et analyser notre trafic. En cliquant sur "Tout accepter", vous acceptez l\'utilisation de TOUS les cookies. Vous pouvez personnaliser vos préférences en cliquant sur "Personnaliser". <a href="/politique-confidentialite" class="cc-link">En savoir plus</a>',
              acceptAllBtn: 'Tout accepter',
              acceptNecessaryBtn: 'Tout refuser',
              showPreferencesBtn: 'Personnaliser',
              footer: ''
            },
            preferencesModal: {
              title: 'Préférences de cookies',
              acceptAllBtn: 'Tout accepter',
              acceptNecessaryBtn: 'Tout refuser',
              savePreferencesBtn: 'Enregistrer les paramètres',
              closeIconLabel: 'Fermer',
              sections: [
                {
                  title: 'Utilisation des cookies',
                  description: 'Nous utilisons des cookies pour améliorer votre expérience sur notre site et analyser son utilisation. Certains cookies sont nécessaires au fonctionnement du site, tandis que d\'autres nous aident à comprendre comment vous interagissez avec notre contenu.'
                },
                {
                  title: 'Cookies strictement nécessaires',
                  description: 'Ces cookies sont essentiels au bon fonctionnement du site. Le site fonctionne sans cookies strictement nécessaires.',
                  linkedCategory: 'necessary'
                },
                {
                  title: 'Cookies analytiques et de performance',
                  description: 'Ces cookies nous permettent de mesurer et d\'analyser l\'utilisation de notre site web afin d\'améliorer ses performances et votre expérience utilisateur.',
                  linkedCategory: 'analytics',
                  cookieTable: {
                    headers: {
                      name: 'Nom',
                      domain: 'Domaine',
                      expiration: 'Expiration',
                      description: 'Description'
                    },
                    body: [
                      {
                        name: '_ga',
                        domain: 'google.com',
                        expiration: '2 ans',
                        description: 'Cookie Google Analytics pour distinguer les utilisateurs'
                      },
                      {
                        name: '_gid',
                        domain: 'google.com',
                        expiration: '24 heures',
                        description: 'Cookie Google Analytics pour distinguer les utilisateurs'
                      },
                      {
                        name: '_gat',
                        domain: 'google.com',
                        expiration: '1 minute',
                        description: 'Cookie Google Analytics pour limiter le taux de requêtes'
                      }
                    ]
                  }
                },
                {
                  title: 'Cookies de contenu tiers',
                  description: 'Ces cookies sont définis par des services tiers intégrés sur notre site (comme YouTube pour les vidéos).',
                  linkedCategory: 'targeting',
                  cookieTable: {
                    headers: {
                      name: 'Nom',
                      domain: 'Domaine',
                      expiration: 'Expiration',
                      description: 'Description'
                    },
                    body: [
                      {
                        name: 'YSC',
                        domain: 'youtube.com',
                        expiration: 'Session',
                        description: 'Cookie YouTube pour suivre les vues de vidéos intégrées'
                      },
                      {
                        name: 'VISITOR_INFO1_LIVE',
                        domain: 'youtube.com',
                        expiration: '6 mois',
                        description: 'Cookie YouTube pour les préférences utilisateur'
                      }
                    ]
                  }
                },
                {
                  title: 'Plus d\'informations',
                  description: 'Pour toute question concernant notre politique de cookies et vos choix, veuillez <a href="/contact" class="cc-link">nous contacter</a> ou consulter notre <a href="/politique-confidentialite" class="cc-link">politique de confidentialité</a>.'
                }
              ]
            }
          }
        }
      },

      // Options d'affichage
      guiOptions: {
        consentModal: {
          layout: 'box',
          position: 'bottom left',
          transition: 'slide'
        },
        preferencesModal: {
          layout: 'box',
          transition: 'slide'
        }
      },

      // Callbacks
      onFirstConsent: function({ cookie }) {
        // Premier consentement enregistré
      },

      onChange: function({ cookie, changedCategories }) {
        // Recharger la page pour appliquer les changements
        if (changedCategories.length > 0) {
          window.location.reload();
        }
      },

      onConsent: function({ cookie }) {
        // Consentement enregistré
      }
    });
  });
</script>

<style is:global>
  /* Personnalisation du bandeau de cookies */
  #cc-main {
    font-family: var(--font-body, 'Inter', sans-serif);
  }

  #cc-main {
    --cc-bg: #0a0a0a;
    --cc-text: #f5f5f5;
    --cc-btn-primary-bg: #b91c1c;
    --cc-btn-primary-text: white;
    --cc-btn-primary-hover-bg: #991b1b;
    --cc-btn-secondary-bg: transparent;
    --cc-btn-secondary-text: #f5f5f5;
    --cc-btn-secondary-hover-bg: rgba(255, 255, 255, 0.1);
    --cc-separator-border-color: rgba(255, 255, 255, 0.1);
    --cc-cookie-category-block-bg: #1a1a1a;
    --cc-cookie-category-block-border: rgba(255, 255, 255, 0.1);
    --cc-toggle-on-bg: #b91c1c;
    --cc-toggle-off-bg: #4a4a4a;
    --cc-toggle-readonly-bg: #4a4a4a;
  }

  /* Modal principal */
  #cc-main .cm {
    background: #0a0a0a !important;
    color: #f5f5f5 !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
    padding: 1rem !important;
  }

  #cc-main .cm__title,
  #cc-main .cm__desc,
  #cc-main .cm__text {
    color: #f5f5f5 !important;
  }

  /* Boutons */
  #cc-main .cm__btn {
    border-radius: 6px;
    font-weight: 600;
    padding: 0.7rem 1.5rem;
    transition: all 0.3s ease;
  }

  #cc-main .cm__btn--primary {
    background: var(--cc-btn-primary-bg);
    border: 2px solid var(--cc-btn-primary-bg);
  }

  #cc-main .cm__btn--primary:hover {
    background: var(--cc-btn-primary-hover-bg);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(185, 28, 28, 0.4);
  }

  #cc-main .cm__btn--secondary, #cc-main .pm__btn--secondary {
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white!important;
  }

  #cc-main .cm__btn--secondary:hover {
    background: var(--cc-btn-secondary-hover-bg);
    border-color: rgba(255, 255, 255, 0.5);
  }

  /* Liens */
  #cc-main .cc-link {
    font-weight: 700;
    color: var(--cc-btn-primary-bg);
  }

  #cc-main .cc-link:hover {
    color: var(--cc-btn-primary-hover-bg);
  }

  /* Modal de paramètres */
  #cc-main .pm.pm--box {
    background: #0a0a0a !important;
    color: #f5f5f5 !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 12px !important;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5) !important;
  }

  #cc-main .pm__title,
  #cc-main .pm__text,
  #cc-main .pm__section-title,
  #cc-main .pm__section-desc {
    color: #f5f5f5 !important;
  }
  
  #cc-main .pm__close-btn svg {
    stroke: white!important;
  }
  
  #cc-main .pm__section--toggle button:hover {
    background: #252525 !important;
  }

  #cc-main .pm__table-caption,#cc-main .pm__table-head>tr {
    color: #b7b8b9!important;
  }

  #cc-main .pm__table-tr {
    color: #b7b8b9!important;
  }

  #cc-main .pm__table-tr:hover {
    background: #111111 !important;
  }
  
  #s-inr {
    background: #0a0a0a !important;
    border-radius: 12px;
  }

  /* Sections de cookies */
  #s-bl .c-bl {
    background: #1a1a1a !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 8px;
    margin-bottom: 1rem;
    transition: all 0.3s ease;
  }

  #s-bl .c-bl:hover {
    background: #252525 !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
  }

  /* Toggle switch */
  .c-tgl:checked ~ .c-tg {
    background: var(--cc-toggle-on-bg);
  }

  /* Tableau de cookies */
  #s-bl table {
    border-collapse: collapse;
    width: 100%;
  }

  #s-bl th {
    background: rgba(185, 28, 28, 0.1);
    color: var(--cc-text);
    font-weight: 600;
    padding: 0.75rem;
    text-align: left;
  }

  #s-bl td {
    padding: 0.75rem;
    border-top: 1px solid var(--cc-separator-border-color);
  }

  /* Responsive */
  @media (max-width: 768px) {
    #cc-main .cm {
      max-width: 95%;
      margin: 1rem;
    }

    #cc-main .cm__btn {
      width: 100%;
      margin-bottom: 0.5rem;
    }
  }
</style>
