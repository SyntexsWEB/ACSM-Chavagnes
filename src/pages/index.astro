---
import Layout from '../layouts/Layout.astro';
import HeroHome from '../components/HeroHome.astro';
import InfosImageSection from '../components/InfosImageSection.astro';
import ImageSplitSection from '../components/ImageSplitSection.astro';
import TrainingSection from '../components/TrainingSection.astro';
import { getCollection } from 'astro:content';
import siteInfo from '../data/site-info.json';

const actualites = (await getCollection('actualites'))
  .filter(a => a.data.publie)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Récupérer la dernière actualité pour la section featured
const latestNews = actualites[0];

const heroData = siteInfo.hero_accueil;
---

<Layout
  titre="Accueil"
  description={siteInfo.description}
>
  <!-- Hero principal -->
  <HeroHome
    soustitre={heroData.soustitre}
    titreLigne1={heroData.titre_ligne1}
    titreLigne2={heroData.titre_ligne2}
    description={heroData.description}
    image={heroData.image}
    bouton1={{
      texte: heroData.bouton1_texte,
      lien: heroData.bouton1_lien
    }}
    bouton2={{
      texte: heroData.bouton2_texte,
      lien: heroData.bouton2_lien
    }}
  />

  <!-- Section Actualité à la une -->
  {latestNews && (
    <section class="featured-news-dark">
      <div class="container">
        <div class="featured-news-content">
          <div class="featured-news-header">
            <h2 class="featured-news-title">ACTUALITÉ À LA UNE</h2>
            <div class="title-underline"></div>
          </div>

          <h4 class="news-article-title">{latestNews.data.titre}</h4>
          <p class="featured-news-description">{latestNews.data.description}</p>

          <div class="featured-news-buttons">
            <a href={`/actualites/${latestNews.slug}`} class="btn-featured-primary">
              Lire l'article
            </a>
            <a href="/actualites" class="btn-featured-secondary">
              Toutes les actualités
            </a>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Section Informations avec image -->
  <InfosImageSection
    image="/images/adobestock_68949462_preview.jpeg"
  />

  <!-- Section Terrain d'entraînement supplémentaire -->
  <TrainingSection
    image="/images/terrain-vue.jpg"
    titre="TERRAIN D'ENTRAÎNEMENT"
    soustitre="MOTOCROSS"
    description="Notre terrain offre une piste technique avec de multiples sauts, virages relevés et whoops. Parfait pour progresser et s'entraîner dans des conditions optimales. Le terrain est entretenu régulièrement pour garantir la meilleure expérience de pilotage."
    boutonTexte="EN SAVOIR PLUS"
    boutonLien="/presentation"
  />

  <!-- Section Catégories Samedi/Dimanche -->
  <ImageSplitSection
    imageSamedi="/images/debutant-mx.jpg"
    imageDimanche="/images/confirmes-mx.jpg"
  />

  <!-- Section Dernières Actualités -->
  {actualites.length > 0 && (
    <section class="recent-news-section">
      <div class="container">
        <div class="section-header-mx">
          <div class="header-logo">
            <span class="mx-prefix">MX</span>
            <h2>ACTUALITÉS</h2>
          </div>
          <div class="header-underline"></div>
          <p class="section-subtitle">Les dernières nouvelles de l'ACSM Chavagnes</p>
        </div>

        <div class="grid grid-3">
          {actualites.slice(0, 3).map((actualite) => (
            <article class="news-card">
              <div class="news-card-image">
                <img src={actualite.data.image} alt={actualite.data.titre} />
                <div class="news-card-overlay"></div>
              </div>
              <div class="news-card-content">
                <time class="news-card-date">
                  {new Intl.DateTimeFormat('fr-FR', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                  }).format(actualite.data.date)}
                </time>
                <h3 class="news-card-title">{actualite.data.titre}</h3>
                <p class="news-card-description">{actualite.data.description}</p>
                <a href={`/actualites/${actualite.slug}`} class="news-card-link">
                  Lire la suite
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </a>
              </div>
            </article>
          ))}
        </div>

        <div class="news-footer">
          <a href="/actualites" class="btn-all-news">Voir toutes les actualités</a>
        </div>
      </div>
    </section>
  )}

  <!-- Section CTA finale -->
  <section class="cta-section-final">
    <div class="container">
      <div class="cta-content">
        <h2>{siteInfo.cta_accueil?.titre || "Prêt à rouler ?"}</h2>
        <p>{siteInfo.cta_accueil?.description || "Rejoignez-nous sur le terrain et vivez votre passion du motocross !"}</p>
        <div class="cta-buttons">
          <a href={siteInfo.cta_accueil?.bouton1_lien || "/faq"} class="btn-cta">{siteInfo.cta_accueil?.bouton1_texte || "Voir la FAQ"}</a>
          <a href={siteInfo.cta_accueil?.bouton2_lien || "/contact"} class="btn-cta-outline">{siteInfo.cta_accueil?.bouton2_texte || "Nous contacter"}</a>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  /* Section Actualité à la une (fond noir) */
  .featured-news-dark {
    background: var(--color-dark);
    padding: var(--spacing-2xl) 0;
    border-top: 1px solid var(--color-border);
  }

  .featured-news-content {
    max-width: 1100px;
    margin: 0 auto;
  }

  .featured-news-header {
    margin-bottom: var(--spacing-lg);
  }

  .featured-news-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    color: white;
    line-height: 1.2;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: -0.02em;
  }

  .title-underline {
    width: 80px;
    height: 4px;
    background: var(--color-primary);
    border-radius: 2px;
  }

  .news-meta {
    margin-bottom: var(--spacing-md);
  }

  .news-date {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--color-primary);
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: var(--radius-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .news-article-title {
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 700;
    color: white;
    margin-bottom: var(--spacing-md);
    line-height: 1.3;
  }

  .featured-news-description {
    font-size: 1.15rem;
    line-height: 1.8;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xl);
  }

  .featured-news-buttons {
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
  }

  .btn-featured-primary {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: var(--color-primary);
    color: white;
    border: 2px solid var(--color-primary);
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-featured-primary:hover {
    background: transparent;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px var(--shadow-primary-strong);
  }

  .btn-featured-secondary {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: transparent;
    color: white;
    border: 2px solid white;
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-featured-secondary:hover {
    background: white;
    color: var(--color-dark);
    transform: translateY(-2px);
  }

  /* Section Dernières Actualités */
  .recent-news-section {
    background: var(--color-dark);
    padding: var(--spacing-2xl) 0;
  }

  .section-header-mx {
    margin-bottom: var(--spacing-2xl);
  }

  .header-logo {
    display: flex;
    align-items: baseline;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-xs);
  }

  .mx-prefix {
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    color: var(--color-text);
    letter-spacing: -0.02em;
    line-height: 1;
  }

  .header-logo h2 {
    font-size: clamp(2rem, 4vw, 3rem);
    font-weight: 800;
    color: var(--color-text);
    letter-spacing: -0.02em;
    margin: 0;
    line-height: 1;
  }

  .header-underline {
    width: 60px;
    height: 4px;
    background: var(--color-primary);
    margin-bottom: var(--spacing-md);
    border-radius: 2px;
  }

  .section-subtitle {
    font-size: 1.1rem;
    color: var(--color-text-secondary);
    margin: 0;
  }

  .news-card {
    background: var(--color-steel);
    border-radius: var(--radius-lg);
    overflow: hidden;
    border: 1px solid var(--color-border);
    transition: all var(--transition-normal);
    display: flex;
    flex-direction: column;
  }

  .news-card:hover {
    transform: translateY(-5px);
    border-color: var(--color-primary);
    box-shadow: 0 10px 30px var(--shadow-dark);
  }

  .news-card-image {
    position: relative;
    width: 100%;
    height: 240px;
    overflow: hidden;
  }

  .news-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--transition-slow);
  }

  .news-card:hover .news-card-image img {
    transform: scale(1.05);
  }

  .news-card-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(180deg, transparent 0%, rgba(10, 10, 10, 0.7) 100%);
  }

  .news-card-content {
    padding: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    flex: 1;
  }

  .news-card-date {
    display: inline-block;
    font-size: 0.85rem;
    color: var(--color-primary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--spacing-sm);
  }

  .news-card-title {
    font-size: 1.35rem;
    font-weight: 700;
    color: white;
    margin-bottom: var(--spacing-sm);
    line-height: 1.3;
  }

  .news-card-description {
    font-size: 0.95rem;
    color: var(--color-text-secondary);
    line-height: 1.6;
    margin-bottom: var(--spacing-md);
    flex: 1;
  }

  .news-card-link {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    color: var(--color-primary);
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-fast);
  }

  .news-card-link:hover {
    gap: var(--spacing-sm);
    color: var(--color-primary-light);
  }

  .news-card-link svg {
    transition: transform var(--transition-fast);
  }

  .news-card-link:hover svg {
    transform: translateX(4px);
  }

  .news-footer {
    text-align: center;
    margin-top: var(--spacing-2xl);
  }

  .btn-all-news {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-xl);
    background: transparent;
    color: var(--color-primary);
    border: 2px solid var(--color-primary);
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-all-news:hover {
    background: var(--color-primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px var(--shadow-primary-strong);
  }

  /* Section CTA finale */
  .cta-section-final {
    background: var(--color-secondary);
    padding: var(--spacing-2xl) 0;
  }

  .cta-content {
    text-align: center;
    max-width: 800px;
    margin: 0 auto;
  }

  .cta-content h2 {
    font-size: clamp(2rem, 4vw, 3rem);
    margin-bottom: var(--spacing-md);
    color: var(--color-dark);
    font-weight: 800;
  }

  .cta-content p {
    font-size: 1.25rem;
    color: var(--color-dark);
    opacity: 0.85;
    margin-bottom: var(--spacing-xl);
  }

  .cta-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-cta {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-xl);
    background: var(--color-dark);
    color: white;
    border: 2px solid var(--color-dark);
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-cta:hover {
    background: var(--color-dark-lighter);
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(10, 10, 10, 0.4);
  }

  .btn-cta-outline {
    display: inline-block;
    padding: var(--spacing-md) var(--spacing-xl);
    background: transparent;
    color: var(--color-dark);
    border: 2px solid var(--color-dark);
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-cta-outline:hover {
    background: var(--color-dark);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(10, 10, 10, 0.4);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .featured-news-buttons {
      flex-direction: column;
    }

    .btn-featured-primary,
    .btn-featured-secondary {
      width: 100%;
      text-align: center;
    }

    .news-card-image {
      height: 200px;
    }

    .cta-buttons {
      flex-direction: column;
      width: 100%;
    }

    .btn-cta,
    .btn-cta-outline,
    .btn-all-news {
      width: 100%;
      text-align: center;
    }
  }
</style>
