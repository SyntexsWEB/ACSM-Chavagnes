---
import Layout from '../layouts/Layout.astro';
import HeroHome from '../components/HeroHome.astro';
import InfosImageSection from '../components/InfosImageSection.astro';
import ImageSplitSection from '../components/ImageSplitSection.astro';
import TrainingSection from '../components/TrainingSection.astro';
import NewsCarousel from '../components/NewsCarousel.astro';
import { getCollection } from 'astro:content';
import siteInfo from '../data/site-info.json';

const actualites = (await getCollection('actualites'))
  .filter(a => a.data.publie)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Récupérer la dernière actualité pour la section featured
const latestNews = actualites[0];

const heroData = siteInfo.hero_accueil;
---

<Layout
  titre="Terrain de Motocross Chavagnes-les-Eaux (Maine-et-Loire)"
  description="ACSM Chavagnes-les-Eaux : terrain de motocross à Terranjou (Maine-et-Loire, Anjou). Circuit homologué FFM/UFOLEP ouvert les 1er et 3ème week-end. À 30 min d'Angers."
  image={heroData.image}
>
  <!-- Hero principal -->
  <HeroHome
    soustitre={heroData.soustitre}
    titreLigne1={heroData.titre_ligne1}
    titreLigne2={heroData.titre_ligne2}
    description={heroData.description}
    image={heroData.image}
    bouton1={{
      texte: heroData.bouton1_texte,
      lien: heroData.bouton1_lien
    }}
    bouton2={{
      texte: heroData.bouton2_texte,
      lien: heroData.bouton2_lien
    }}
  />

  <!-- Section Actualité à la une -->
  {latestNews && (
    <section class="featured-news-dark">
      <div class="container">
        <div class="featured-news-content">
          <div class="featured-news-header">
            <h2 class="featured-news-title">ACTUALITÉ À LA UNE</h2>
            <div class="title-underline"></div>
          </div>

          <h4 class="news-article-title">{latestNews.data.titre}</h4>
          <p class="featured-news-description">{latestNews.data.description}</p>

          <div class="featured-news-buttons">
            <a href={`/actualites/${latestNews.slug}`} class="btn-featured-primary">
              Lire l'article
            </a>
            <a href="/actualites" class="btn-featured-secondary">
              Toutes les actualités
            </a>
          </div>
        </div>
      </div>
    </section>
  )}

  <!-- Section Informations avec image -->
  <InfosImageSection
    image="/images/depart-premier-virage-2.jpg"
  />

  <!-- Section Terrain d'entraînement -->
  <TrainingSection
    titre="TERRAIN D'ENTRAÎNEMENT"
    soustitre="MOTOCROSS"
    description="Notre terrain offre une piste technique avec de multiples sauts, virages relevés et whoops. Parfait pour progresser et s'entraîner dans des conditions optimales. Le terrain est entretenu régulièrement pour garantir la meilleure expérience de pilotage."
    boutonTexte="EN SAVOIR PLUS"
    boutonLien="/presentation"
    bouton2Texte="GALERIE PHOTO"
    bouton2Lien="/presentation#galerie-photo"
  />

  <!-- Section Catégories Samedi/Dimanche -->
  <ImageSplitSection
    imageSamedi="/images/motocross-saut-2.jpg"
    imageDimanche="/images/motocross-expert.png"
  />

  <!-- Section Dernières Actualités - Carrousel -->
    {actualites.length > 0 && (
      <NewsCarousel actualites={actualites} />
    )}

  <!-- Section CTA finale style moderne -->
  <section class="cta-section-final">
    <div class="container">
      <a href={siteInfo.cta_accueil?.bouton2_lien || "/contact"} class="cta-card-link">
        <div class="cta-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="7" y1="17" x2="17" y2="7"></line>
            <polyline points="7 7 17 7 17 17"></polyline>
          </svg>
        </div>
        <div class="cta-card">
          <h2>{siteInfo.cta_accueil?.titre || "Prêt à rouler ?"}</h2>
          <p>{siteInfo.cta_accueil?.description || "Rejoignez-nous sur le terrain et vivez votre passion du motocross !"}</p>
          <div class="cta-buttons">
            <span class="btn-cta-outline">{siteInfo.cta_accueil?.bouton2_texte || "Nous contacter"}</span>
          </div>
        </div>
      </a>
    </div>
  </section>
</Layout>

<style>
  /* Section Actualité à la une (fond noir) */
  .featured-news-dark {
    background: var(--color-dark);
    padding: var(--spacing-3xl) 0;
    border-top: 1px solid var(--color-border);
  }

  .featured-news-content {
    max-width: 1100px;
    margin: 0 auto;
  }

  .featured-news-header {
    margin-bottom: var(--spacing-lg);
  }

  .featured-news-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    font-weight: 800;
    color: white;
    line-height: 1.2;
    margin-bottom: var(--spacing-md);
    text-transform: uppercase;
    letter-spacing: -0.02em;
  }

  .title-underline {
    width: 80px;
    height: 4px;
    background: var(--color-primary);
    border-radius: 2px;
  }

  .news-meta {
    margin-bottom: var(--spacing-md);
  }

  .news-date {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--color-primary);
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    border-radius: var(--radius-md);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .news-article-title {
    font-size: clamp(1.5rem, 3vw, 2rem);
    font-weight: 700;
    color: white;
    margin-bottom: var(--spacing-md);
    line-height: 1.3;
  }

  .featured-news-description {
    font-size: 1.15rem;
    line-height: 1.8;
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xl);
  }

  .featured-news-buttons {
    display: flex;
    gap: var(--spacing-md);
    flex-wrap: wrap;
  }

  .btn-featured-primary {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: var(--color-primary);
    color: white;
    border: 2px solid var(--color-primary);
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-featured-primary:hover {
    background: transparent;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px var(--shadow-primary-strong);
  }

  .btn-featured-secondary {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    background: transparent;
    color: white;
    border: 2px solid white;
    border-radius: var(--radius-md);
    font-weight: 700;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all var(--transition-normal);
  }

  .btn-featured-secondary:hover {
    background: white;
    color: var(--color-dark);
    transform: translateY(-2px);
  }

  /* Section CTA finale - Style identique à l'image (couleurs inversées) */
  .cta-section-final {
    background: var(--color-dark);
    padding: var(--spacing-2xl) 0;
  }

  .cta-card-link {
    display: block;
    text-decoration: none;
    position: relative;
  }

  .cta-icon {
    position: absolute;
    top: -25px;
    left: 50%;
    transform: translateX(-50%);
    width: 50px;
    height: 50px;
    background: var(--color-primary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    z-index: 10;
    transition: all var(--transition-normal);
  }

  .cta-card-link:hover .cta-icon {
    transform: translateX(-50%) scale(1.2);
    box-shadow: 0 8px 25px rgba(185, 28, 28, 0.6);
    animation: pop 0.3s ease;
  }

  @keyframes pop {
    0% { transform: translateX(-50%) scale(1); }
    50% { transform: translateX(-50%) scale(1.3); }
    100% { transform: translateX(-50%) scale(1.2); }
  }

  .cta-card {
    background: var(--color-dark-lighter);
    border-radius: 20px;
    padding: clamp(3.5rem, 8vw, 5rem) clamp(2rem, 5vw, 5rem) clamp(3rem, 8vw, 5rem);
    text-align: center;
    transition: all var(--transition-normal);
    border: 2px solid transparent;
  }

  .cta-card-link:hover .cta-card {
    border-color: var(--color-primary);
  }

  /* Section CTA finale  */
  .cta-section-final {
    background: var(--color-dark);
    padding: var(--spacing-2xl) 0 var(--spacing-lg) 0;
  }

  .cta-content {
    text-align: center;
    transition: all var(--transition-normal);
    border: 2px solid transparent;
  }

  .cta-card-link:hover .cta-card {
    border-color: var(--color-primary);
  }

  .cta-card h2 {
    font-size: clamp(1.8rem, 4vw, 2.8rem);
    margin-bottom: var(--spacing-lg);
    color: white;
    font-weight: 900;
    line-height: 1.2;
    text-transform: uppercase;
    letter-spacing: -0.02em;
  }

  .cta-card p {
    font-size: clamp(1rem, 2vw, 1.15rem);
    color: var(--color-text-secondary);
    margin-bottom: var(--spacing-xl);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .cta-buttons {
    display: flex;
    gap: var(--spacing-md);
    justify-content: center;
    flex-wrap: wrap;
  }

  .btn-cta-outline {
    display: inline-block;
    padding: 0.9rem 1.8rem;
    background: transparent;
    color: white;
    border: 2px solid white;
    border-radius: 25px;
    font-weight: 700;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    transition: all var(--transition-normal);
  }

  .cta-card-link:hover .btn-cta-outline {
    background: var(--color-primary);
    color: white;
    border-color: var(--color-primary);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .featured-news-buttons {
      flex-direction: column;
    }

    .btn-featured-primary,
    .btn-featured-secondary {
      width: 100%;
      text-align: center;
      font-size: 0.75rem;
      padding: 0.7rem 1.3rem;
    }

    .cta-buttons {
      flex-direction: column;
      width: 100%;
    }

    .btn-cta-primary,
    .btn-cta-outline,
    .btn-all-news {
      width: 100%;
      text-align: center;
    }
  }
</style>
